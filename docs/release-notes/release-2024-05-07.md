---
title: 0.56 - May 2024
---

# Release Notes Version 0.56 - May 2024

:::warning
This release contains deprecations and breaking changes
:::

## Values In TypeSpec

Decorators often expect some sort of configuration to be passed as an argument. In version `0.51.0` we introduced the `valueof` keyword to constrain a decorator or template parameter to be a value, however this was limited to string, numeric and boolean values.
When dealing with more complex decorators or free form data one had to use a model type to represent the data. This required a lot of manual validation in the decorator implementation and introduce a lot of potential issues(Passing a subtype like a union instead of a model)

In this release we introduce a whole new world to TypeSpec, values. This include new syntax for declaring object and array values, scalar constructors, `const`.

### Object values

Object values can be declared with the `#{}` syntax.

```tsp
const user = #{ name: "Bob", age: 48, address: #{ city: "London" } };
```

### Array values

Array values can be declared with the `#[]` syntax.

```tsp
const users = #["Bob", "Frank"];
```

### `const`

Const are the value world equivalent of `alias` but also allows you to specify a type

```tsp
const name = "Bob";
const name: string = "Bob";
```

### Scalar constructors

Scalars also needs to be able to define values. For scalars that don't extend a base type like `string`, `number` or `boolean` which have literal syntax you can define a constructor.

```tsp
scalar ipV4 {
  init fromInt(value: int32);
}

const ip: ipV4 = ipV4.fromInt(3232235776);
```

[See values doc for more info](https://typespec.io/docs/language-basics/values)

## Breaking Changes

### @typespec/http

- [#2945](https://github.com/microsoft/typespec/pull/2945) Empty model after removing metadata and visibility property result in void always
  This means the following case have changed from returning `{}` to no body

  ```tsp
  op b1(): {};
  op b2(): {
    @visibility("none") prop: string;
  };
  op b3(): {
    @added(Versions.v2) prop: string;
  };
  ```

  Workaround: Use explicit `@body`

  ```tsp
  op b1(): {
    @body _: {};
  };
  op b2(): {
    @body _: {
      @visibility("none") prop: string;
    };
  };
  op b3(): {
    @body _: {
      @added(Versions.v2) prop: string;
    };
  };
  ```

- [#2945](https://github.com/microsoft/typespec/pull/2945) Implicit status code always 200 except if response is explicitly `void`

  ```tsp
  op c1(): {
    @header foo: string;
  }; // status code 200 (used to be 204)
  ```

  Solution: Add explicit `@statusCode`

  ```tsp
  op c1(): {
    @header foo: string;
    @statusCode _: 204;
  };
  op c1(): {
    @header foo: string;
    ...NoContent;
  }; // or spread common model
  ```

- [#2945](https://github.com/microsoft/typespec/pull/2945) `@body` means this is the body

  This change makes it that using `@body` will mean exactly this is the body and everything underneath will be included, including metadata properties. It will log a warning explaining that.

  ```tsp
  op a1(): {@body _: {@header foo: string, other: string} };
                  ^ warning header in a body, it will not be included as a header.
  ```

  Solution use `@bodyRoot` as the goal is only to change where to resolve the body from.

  ```tsp
  op a1(): {
    @bodyRoot _: {
      @header foo: string;
      other: string;
    };
  };
  ```

- [#2945](https://github.com/microsoft/typespec/pull/2945) Properties are not automatically omitted if everything was removed from metadata or visibility

  ```tsp
  op d1(): {
    headers: {
      @header foo: string;
    };
  }; // body will be {headers: {}}
  ```

  Solution: use `@bodyIgnore`

  ```tsp
  op d1(): {
    @bodyIgnore headers: {
      @header foo: string;
    };
  }; // body will be {headers: {}}
  ```

## Deprecations

### @typespec/compiler

- [e0d7bf5](https://github.com/microsoft/typespec/commit/e0d7bf5238e015e32427a3df48281153117add83) Using a tuple type as a value is deprecated. Tuple types in contexts where values are expected must be updated to be array values instead. A codefix is provided to automatically convert tuple types into array values.

```tsp
model Test {
  // Deprecated
  values: string[] = ["a", "b", "c"];

  // Correct
  values: string[] = #["a", "b", "c"];
}
```

- [e0d7bf5](https://github.com/microsoft/typespec/commit/e0d7bf5238e015e32427a3df48281153117add83) Using a model type as a value is deprecated. Model types in contexts where values are expected must be updated to be object values instead. A codefix is provided to automatically convert model types into object values.

```tsp
model Test {
  // Deprecated
  user: {
    name: string;
  } = {
    name: "System";
  };

  // Correct
  user: {
    name: string;
  } = #{ name: "System" };
}
```

- [327e4fb](https://github.com/microsoft/typespec/commit/327e4fb576f62e4cbba2bb101951600260466ac1) Decorator API: Legacy marshalling logic

With the introduction of values, the decorator marshalling behavior has changed in some cases. This behavior is opt-in by setting the `valueMarshalling` package flag to `"new"`, but will be the default behavior in future versions. It is strongly recommended to adopt this new behavior as soon as possible.

Example:

```tsp
extern dec multipleOf(target: numeric | Reflection.ModelProperty, value: valueof numeric);
```

Will now emit a deprecated warning because `value` is of type `valueof string` which would marshall to `Numeric` under the new logic but as `number` previously.

To opt-in you can add the following to your library js/ts files.

```ts
export const $flags = definePackageFlags({
  decoratorArgMarshalling: "new",
});
```

## Features

### @typespec/compiler

- [80518d2](https://github.com/microsoft/typespec/commit/80518d2bfd0e7078880891d8fae746979645ebb1) Add syntax for declaring values. [See docs](https://typespec.io/docs/language-basics/values).

Object and array values

```tsp
@dummy(#{
  name: "John",
  age: 48,
  address: #{ city: "London" }
  aliases: #["Bob", "Frank"]
})
```

Scalar constructors

```tsp
scalar utcDateTime {
  init fromISO(value: string);
}

model DateRange {
  minDate: utcDateTime = utcDateTime.fromISO("2024-02-15T18:36:03Z");
}
```

- [#3035](https://github.com/microsoft/typespec/pull/3035) `getEncode` returns the fully equalied enum member name if using a custom enum.
- [#3183](https://github.com/microsoft/typespec/pull/3183) Show template parameters when hovering on an operation template

### @typespec/rest

- [#2945](https://github.com/microsoft/typespec/pull/2945) Add supoort for new `@bodyRoot` and `@body` distinction

### @typespec/openapi3

- [#2945](https://github.com/microsoft/typespec/pull/2945) Add supoort for new `@bodyRoot` and `@body` distinction
- [894d08c](https://github.com/microsoft/typespec/commit/894d08c4737d004f3c86544bcda91fb6c8deb4a8) Add support for new object and array values as default values (e.g. `decimals: decimal[] = #[123, 456.7];`)

### @typespec/html-program-viewer

- [483f27c](https://github.com/microsoft/typespec/commit/483f27ccf72a9c88519ee20e0e1178509020af27) Add support for values

## Bug Fixes

### @typespec/compiler

- [#3170](https://github.com/microsoft/typespec/pull/3170) `--nostdlib` flag will now work by only applying to optional standard library types
- [#3212](https://github.com/microsoft/typespec/pull/3212) Fix: augmenting template model property could result in sending invalid argument to decorator
- [#3188](https://github.com/microsoft/typespec/pull/3188) Fix: Do not crash when trying to access member of aliased expressions
- [#3185](https://github.com/microsoft/typespec/pull/3185) Fix tsp init hanging when done due to unclosed connection
- [#3151](https://github.com/microsoft/typespec/pull/3151) IDE: Fix completion of statement keywords
- [#3287](https://github.com/microsoft/typespec/pull/3287) Templated interface extending another templated interface shouldn't run decorator on their operations
- [#3290](https://github.com/microsoft/typespec/pull/3290) Model with an optional property should not be satisfy a constraint with that property required. (`{foo?: string}` cannot be assigned to a constraint of `{foo: string}`)
- [#3163](https://github.com/microsoft/typespec/pull/3163) Fix: Model with spread indexer shouldn't validate explicit properites
- [#3227](https://github.com/microsoft/typespec/pull/3227) Stop running decorators on partially instantiated operations(When interface is instantiated but not the operation)
- [#3180](https://github.com/microsoft/typespec/pull/3180) Fix issue where directives were not parsed to the leaf node in multi-segment Namespace segments.
- [#3243](https://github.com/microsoft/typespec/pull/3243) Fix calling `tsp install` on windows due to recent NodeJS breaking change to fix vulnerability.
- [#3216](https://github.com/microsoft/typespec/pull/3216) Fix compiler crash when using an invalid `is` target in an interface operation template
- [#3191](https://github.com/microsoft/typespec/pull/3191) [API] Add new `sourceModels` property to model
- [#3246](https://github.com/microsoft/typespec/pull/3246) Internals: Use node built-in `fetch` API that is now stable since node `18.13.0`

### @typespec/http

- [29b49f8](https://github.com/microsoft/typespec/commit/29b49f85806fdefe927c1bc9f9eecb8154e41481) Update Flow Template to make use of the new array values
- [#3196](https://github.com/microsoft/typespec/pull/3196) Fix password flow defining `authorizationUrl` instead of `tokenUrl`
- [#3190](https://github.com/microsoft/typespec/pull/3190) Fix `@path` param mapping when spreading a record in operation parameters
- [#3218](https://github.com/microsoft/typespec/pull/3218) Fix: `@path` property shouldn't be applicableMetadata if the visibility contain `Read`

### @typespec/versioning

- [34adfbe](https://github.com/microsoft/typespec/commit/34adfbe2abcaf2ad04e28856340ecf8135607faf) Update to support new value types
- [#3264](https://github.com/microsoft/typespec/pull/3264) Fix crash when `@service` inside a versioned namespace

### @typespec/rest

- [894d08c](https://github.com/microsoft/typespec/commit/894d08c4737d004f3c86544bcda91fb6c8deb4a8) Update types to support new values in TypeSpec

### @typespec/openapi3

- [#3218](https://github.com/microsoft/typespec/pull/3218) Fix: `@path` property should be included in unreachable models

### @typespec/protobuf

- [34adfbe](https://github.com/microsoft/typespec/commit/34adfbe2abcaf2ad04e28856340ecf8135607faf) Update to support new value types

### @typespec/html-program-viewer

- [#3191](https://github.com/microsoft/typespec/pull/3191) Add `sourceModels` property to model view

### @typespec/json-schema

- [34adfbe](https://github.com/microsoft/typespec/commit/34adfbe2abcaf2ad04e28856340ecf8135607faf) Update to support new value types
