[tox]
envlist=base, lint, mypy, pyright, apiview, sphinx
skipsdist=True

[testenv:ci]
deps=
    -r requirements.txt
commands =
    # pytest
    {[testenv:test]commands}

    # pylint
    {[testenv:lint]commands}

    # mypy
    {[testenv:mypy]commands}

    # pyright
    {[testenv:pyright]commands}

    # apiview
    {[testenv:apiview]commands}

    # sphinx docstring validation
    {[testenv:sphinx]commands}

[testenv:test]
deps=
    -r requirements.txt
commands =
    pytest mock_api_tests ../generic_mock_api_tests

[testenv:lint]
deps=
    -r requirements.txt
commands =
    pip install azure-pylint-guidelines-checker==0.5.2 --index-url="https://pkgs.dev.azure.com/azure-sdk/public/_packaging/azure-sdk-for-python/pypi/simple/"
    python ../../../eng/scripts/ci/run_pylint.py -t azure -s "generated" {posargs}

[testenv:mypy]
deps=
    -r requirements.txt
commands =
    python ../../../eng/scripts/ci/run_mypy.py -t azure -s "generated" {posargs}

[testenv:pyright]
deps=
    -r requirements.txt
commands =
    python ../../../eng/scripts/ci/run_pyright.py -t azure -s "generated" {posargs}

[testenv:apiview]
deps=
    -r requirements.txt
commands =
    pip install apiview-stub-generator==0.3.19 --index-url="https://pkgs.dev.azure.com/azure-sdk/public/_packaging/azure-sdk-for-python/pypi/simple/"
    python ../../../eng/scripts/ci/run_apiview.py -t azure -s "generated" {posargs}

[testenv:sphinx]
basepython = python3.10
deps=
    -r requirements.txt
commands =
    python ../../../eng/scripts/ci/run_sphinx_build.py -t azure -s "generated" {posargs}
